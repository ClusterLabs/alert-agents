.nh
.TH alert_smtp_filtered.sh 5 "July 2025" alert_smtp_filtered.sh "User Manual"

.SH NAME
alert_smtp_filtered.sh \- Sample SMTP alert agent for pacemaker with filtering


.SH SYNOPSIS
pcs alert create id=filtered-smtp path=/var/lib/pacemaker/\fBalert_smtp_filtered.sh\fP options \fBemail_sender=\fPnoreply@example.com \fBRHA_alert_kind=\fP"fencing"


.SH DESCRIPTION
\fBalert_smtp_filtered.sh\fP is a sample alert agent which implements filtering by matching the
value of pacemaker's CRM_alert_kind variable that is set when an alert is generated. This
agent was built for a client who wished to send receive alerts whenever resources are relocated,.

.PP
By default, the email client the script expects is sendmail.


.SH OPTIONS
\fBpath=\fP_/var/lib/pacemaker/alert_smtp\fIfiltered.sh\fP

.PP
This is the path to the alert agent on the nodes' filesystems.

.PP
\fBemail_sender=\fP\fIuser@example.com\fP

.PP
This is what the agent will use as the "FROM" field on email alerts

.PP
\fBRHA_alert_kind=\fP\fI"fencing,node,resource,attribute"\fP

.PP
This option sets the RHA_alert_kind variable in the alert_smtp_filtered alert agent, to specify the
criteria on which alerts to allow to send to the email recipient.

.PP
Note that otherwise-unspecified alert types will be sent to the recipient regardless of the filter
specification.

.PP
\fIfencing\fP

.EX
These alerts are generated when a node is fenced, whether automatically or automatically.
.EE

.PP
\fInode\fP

.EX
These alerts when a node is suspended, unsuspended, rebooted, joins the cluster, etc. 
.EE

.PP
\fIresource\fP

.EX
These alerts are generated when a resource is started, stopped, or fails to start. 
.EE

.PP
\fIattriubute\fP

.EX
These alerts are generated when a resource's attribute is changed. 
.EE


.SH EXAMPLES
The following example will send alert emails whenever a node is fenced and also unhandled alerts,
but not node, resource, or attribute alerts.

.EX
[root@nodea ~]# pcs alert create id=filtered-smtp path=/var/lib/pacemaker/alert_smtp_filtered.sh options email_sender=noreply@example.com RHA_alert_kind="fencing"
[root@nodea ~]# pcs alert recipient add smtp-alert value=student@workstation.lab.example.com 
Error: alert 'smtp-alert' does not exist
[root@nodea ~]# pcs alert recipient add filtered-smtp value=student@workstation.lab.example.com  
[root@nodea ~]# 
.EE

.PP
This example will send alerts of kind node, resource, attribute, and "unhandled" alerts, but not fencing notifications:

.EX
 ~]# pcs alert create id=filtered-smtp path=/var/lib/pacemaker/alert_smtp_filtered.sh options email_sender=noreply@example.com RHA_alert_kind="node,resource,attribute"
 ~]# pcs alert recipient add filtered-smtp value=student@workstation.lab.example.com  
 ~]# 
.EE


.SH HISTORY
July 2025, Originally compiled by Kimberly Lazarski (klazarsk@redhat.com)
